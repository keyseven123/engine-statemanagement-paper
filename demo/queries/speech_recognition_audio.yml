query: |
  SELECT start, end, label
  FROM ( 
  SELECT start, end, SpeechRecognitionLabel(ArgMax(output)) as label, MaxValue(output), INFER_MODEL(speech_recognition, (chunked))
  FROM (
      SELECT COUNT(value) as samples, MERGE(value) as chunked
      FROM audio_stream WINDOW SLIDING(timestamp, size 1000000 ms, advance by 20000 ms)
  )
  )
  WHERE label = VARSIZED("nine")
  INTO csv_sink
sink:
  name: csv_sink
  type: MQTT
  config:
    inputFormat: JSON
    serverURI: mqtt://mosquitto:1883
    clientId: i am a client3
    topic: test/messages3
    qos: 1
logical:
  - name: audio_stream
    schema:
      - name: timestamp
        type: UINT64
      - name: value
        type: FLOAT32
physical:
  - logical: audio_stream
    parserConfig:
      type: Raw
    sourceConfig:
      type: Audio
      socketPort: 1234
      socketHost: mic-stream
      sampleRate: 16000
      sampleWidth: 2
models:
  - path: model/audio_model.onnx
#  - path: /model/audio_model.onnx
    name: speech_recognition
    inputs:
      - VARSIZED
    outputs:
      - name: output
        type: VARSIZED
