# name: milestone/Nexmark.test
# description: Nexmark benchmark
# groups: [milestone, benchmark, large]

# Source definitions
SourceCSV bid UINT64 timestamp INT32 auction INT32 bidder INT64 datetime FLOAT64 price TESTDATA/large/bid.csv
SourceCSV auction UINT64 timestamp INT32 id INT32 initialbid INT32 reserve INT64 expires INT32 seller INT32 category TESTDATA/large/auction_modified.csv


# Query 0
SELECT * FROM bid INTO CHECKSUM;
----


# Query 1
SELECT price * 89 / 100 AS price FROM bit INTO CHECKSUM;
----


# Query 2
SELECT * FROM bid WHERE auctionId % 123 = 0 INTO CHECKSUM;
----


# Query 5
SELECT L.auctionId, L.num
FROM (
    SELECT
        auctionId,
        COUNT(*) AS num,
        WINDOW_START AS start
    FROM bid
    GROUP BY auctionId
    WINDOW SLIDING(timestamp, SIZE 10 SEC, ADVANCE BY 2 SEC)
) AS L
JOIN (
    SELECT
        auctionId,
        MAX(num) AS max,
        WINDOW_START AS start
    FROM (
        SELECT
            auctionId,
            COUNT(*) AS num,
            WINDOW_START AS start
        FROM bid
        GROUP BY auctionId
        WINDOW SLIDING(timestamp, SIZE 10 SEC, ADVANCE BY 2 SEC)
    ) AS temp
    GROUP BY auctionId
    WINDOW TUMBLING(start, SIZE 10 SEC)
) AS R
  ON L.start = R.start
WINDOW SLIDING(L.start, SIZE 10 SEC, ADVANCE BY 2 SEC)
WHERE L.num >= R.max
INTO SINK;
----


# Query 7
TODO: Implement this query as it is missing
----



#Query 8

SELECT start, end, timestamp, auction, bidder, datetime, price, initialbid, reserve, expires, seller, category FROM (SELECT * FROM bid) INNER JOIN (SELECT * FROM auction) ON auction = id WINDOW TUMBLING (timestamp, size 100 sec) INTO CHECKSUM;
----
17210624,84318969243