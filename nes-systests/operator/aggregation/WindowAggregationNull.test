# name: window/WindowAggregationNull.test
# description: Test window aggregation with null values
# groups: [Aggregation, WindowOperators]

# Source definitions
Source stream UINT64 ts INT32 id INT32 value_NULLABLE
0,0,
50,0,1
100,0,2
150,1,
200,0,10
350,2,4
350,0,
350,1,1
350,0,2
500,2,-1

SINK sinkStreamSum UINT64 stream$start UINT64 stream$end INT32 stream$valueSum
SINK sinkStreamCount UINT64 stream$start UINT64 stream$end INT32 stream$id INT32 stream$valueCount

# Checking if a sum over a tumbling window works with null values in the value field
# We expect NULLs to be ignored in value fields for SUM aggregation
SELECT SUM(value_NULLABLE) as valueSum
FROM stream WINDOW TUMBLING(ts, size 100 ms)
INTO sinkStreamSum
----
0,100,1
100,200,2
200,300,10
300,400,7
500,600,-1


# Checking if a sum over a sliding window works with null values in the value field
SELECT SUM(value_NULLABLE) as valueSum
FROM stream WINDOW SLIDING(ts, size 100 ms, advance by 50 ms)
INTO sinkStreamSum
----
0,100,1
50,150,3
100,200,2
150,250,10
200,300,10
300,400,7
350,450,7
450,550,-1
500,600,-1
