# name: window/WindowAggregationNull.test
# description: Test window aggregation with null values
# groups: [Aggregation, WindowOperators]

# Source definitions
Source stream UINT64 ts INT32 id INT32 value_NULLABLE
0,0,
20,1,3
50,0,1
100,0,2
150,1,
200,0,10
350,2,4
350,0,
350,1,1
350,0,2
500,2,-1
520,0,11
530,0,

SINK sink0 UINT64 stream$start UINT64 stream$end INT32 stream$valueSum
SINK sink1 UINT64 stream$start UINT64 stream$end INT32 stream$valueSum INT32 stream$valueMax INT32 stream$valueMin FLOAT64 stream$valueAvg

# Checking if a sum over a tumbling window works with null values in the value field
# We expect NULLs to be ignored in value fields for SUM aggregation
SELECT SUM(value_NULLABLE) as valueSum
FROM stream WINDOW TUMBLING(ts, size 100 ms)
INTO sink0
----
0,100,4
100,200,2
200,300,10
300,400,7
500,600,10


# Checking if a sum over a sliding window works with null values in the value field
SELECT SUM(value_NULLABLE) AS valueSum, MAX(value_NULLABLE) AS valueMax,
       MIN(value_NULLABLE) AS valueMin, AVG(value_NULLABLE) AS valueAvg
FROM stream WINDOW SLIDING(ts, size 100 ms, advance by 50 ms)
INTO sink1
----
0,100,4,3,1,2.0
50,150,3,2,1,1.5
100,200,2,2,2,2.0
150,250,10,10,10,10.0
200,300,10,10,10,10.0
300,400,7,4,1,2.333333
350,450,7,4,1,2.333333
450,550,10,11,-1,5.0
500,600,10,11,-1,5.0
