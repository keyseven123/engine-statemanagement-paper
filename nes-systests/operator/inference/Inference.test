# name: inference/Inference.test
# description: Inference test
# groups: [Inference]

# Source definitions
SourceCSV iris FLOAT32 f1 FLOAT32 f2 FLOAT32 f3 FLOAT32 f4 TESTDATA/iris.csv
SourceCSV inspections FLOAT32 f1 FLOAT32 f2 FLOAT32 f3 FLOAT32 f4 FLOAT32 f5 TESTDATA/inspections.csv

SINK irisSink FLOAT32 iris$p1 FLOAT32 iris$p2 FLOAT32 iris$p3
SINK inspectionsSink FLOAT32 inspections$v1
SINK commonSink FLOAT32 inspections$v1 FLOAT32 inspections$p1 FLOAT32 inspections$p2 FLOAT32 inspections$p3

# Classification single tuple
SELECT INFER_MODEL("/home/gaturchenko/CLionProjects/nebulastream-public/nes-plugins/Inference/IREE/models/model_iris.mlir", (f1, f2, f3, f4), (p1, p2, p3))
FROM iris
WHERE (p1 > 0 AND p1 < 1)
      AND (p2 > 0 AND p2 < 1)
      AND (p3 > 0 AND p3 < 1)
INTO irisSink
----
0.04465 0.332453 0.622897

# Regression single tuple
SELECT INFER_MODEL("/home/gaturchenko/CLionProjects/nebulastream-public/nes-plugins/Inference/IREE/models/model_inspections.mlir", (f1, f2, f3, f4, f5), (v1))
FROM inspections
WHERE v1 > 18 AND v1 < 19
INTO inspectionsSink
----
18.9402

# Two models
SELECT INFER_MODEL("/home/gaturchenko/CLionProjects/nebulastream-public/nes-plugins/Inference/IREE/models/model_inspections.mlir", (f1, f2, f3, f4, f5), (v1)),
       INFER_MODEL("/home/gaturchenko/CLionProjects/nebulastream-public/nes-plugins/Inference/IREE/models/model_iris.mlir", (f1, f2, f3, f4), (p1, p2, p3))
FROM inspections
INTO commonSink
----
18.940191 1.0 0.0 0.0